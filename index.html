<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>【上架】碳基生物商品化装置</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #008080; font-family: 'SimSun', serif; padding: 20px; }
        .win95-border { box-shadow: inset 1.5px 1.5px 0px #fff, inset -1.5px -1.5px 0px #808080, 1px 1px 0px #000; background: #c0c0c0; border: 1px solid #000; }
        .win95-btn { box-shadow: inset 1.5px 1.5px 0px #fff, inset -1.5px -1.5px 0px #808080, 1px 1px 0px #000; background: #c0c0c0; font-weight: bold; }
        .win95-btn:active { box-shadow: inset 1.5px 1.5px 0px #808080, 1px 1px 0px #fff; transform: translate(1px, 1px); }
        .win95-btn:disabled { color: #808080; opacity: 0.6; }
    </style>
</head>
<body class="flex flex-col items-center">
    <div class="win95-border p-4 w-full max-w-2xl">
        <div id="drop-zone" class="border-2 border-dashed border-gray-600 h-40 flex items-center justify-center mb-4 cursor-pointer">
            <p>点击或拖入照片</p>
            <input type="file" id="file-input" class="hidden" accept="image/*">
        </div>
        <button id="submit-btn" class="win95-btn w-full py-2">执行上架程序 [EXE]</button>
        <button id="gallery-btn" class="win95-btn w-full py-2 mt-2" disabled onclick="location.href='/gallery'">查看货架 [GALLERY]</button>
    </div>

    <script>
        const fileInput = document.getElementById('file-input');
        const submitBtn = document.getElementById('submit-btn');
        const galleryBtn = document.getElementById('gallery-btn');

        submitBtn.onclick = async () => {
            if (!fileInput.files[0]) return alert("请先选择照片");
            
            submitBtn.disabled = true;
            submitBtn.innerText = "打码中...";
            
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            try {
                // 指向 /upload 接口
                const response = await fetch('/upload', { method: 'POST', body: formData });
                const data = await response.json();
                
                if (data.status === 'success') {
                    alert("上架成功！已同步至云端。");
                    galleryBtn.disabled = false;
                    galleryBtn.style.backgroundColor = "#000080";
                    galleryBtn.style.color = "white";
                } else {
                    alert("错误: " + data.message);
                }
            } catch (err) {
                alert("网络连接失败");
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerText = "执行上架程序 [EXE]";
            }
        };

        document.getElementById('drop-zone').onclick = () => fileInput.click();
    </script>
</body>
</html>
